---
import Logo from "@/components/Logo.astro";
import menu from "@/config/menu.json";
import config from "@/config/config.json";
import ThemeSwitcher from "@/components/ThemeSwitcher.astro";

const { settings, company } = config;
const primaryCta = company?.primary_cta;

const isMenuItemActive = (url: string) => {
  const pathname = Astro.url.pathname;
  if (url === "/") {
    return pathname === url ? "active" : "";
  }
  return pathname.startsWith(url) ? "active" : "";
};
---
<header
  class:list=[
    "site-header z-30 w-full",
    settings?.sticky_header && "sticky top-0",
    "shadow-sm",
  ]
>
  <div class="w-full bg-[#0056A8]">
    <nav class="mx-auto flex w-full max-w-[1320px] items-center justify-between px-6 py-4">
    <div class="flex items-center gap-4">
      <Logo />
    </div>

    <button
      id="mobile-nav-toggle"
      class="md:hidden inline-flex items-center justify-center rounded-md border border-white/40 bg-white/10 p-2 text-white transition hover:bg-white/20"
      aria-label="メニューを開く"
      aria-controls="mobile-nav"
      aria-expanded="false"
    >
      <svg data-icon="open" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
        <title>Open menu</title>
        <path d="M0 3h20v2H0V3zm0 6h20v2H0V9zm0 6h20v2H0v-2z" />
      </svg>
      <svg data-icon="close" class="h-5 w-5 hidden" viewBox="0 0 20 20" fill="currentColor">
        <title>Close menu</title>
        <polygon points="11 9 22 9 22 11 11 11 11 22 9 22 9 11 -2 11 -2 9 9 9 9 -2 11 -2" transform="rotate(45 10 10)" />
      </svg>
    </button>

    <ul class="site-header__menu hidden md:flex items-center gap-8 text-sm font-medium">
      {
        menu.main.map((menuItem) => (
          <li>
            <a
              href={menuItem.url}
              class:list=[
                "site-header__menu-link",
                isMenuItemActive(menuItem.url) && "is-active",
              ]
              style="color:#ffffff"
            >
              {menuItem.name}
            </a>
          </li>
        ))
      }
    </ul>

    <div class="hidden md:flex items-center gap-4">
      {settings?.theme_switcher && <ThemeSwitcher className="hidden md:block" />}
      {
        primaryCta?.label && primaryCta?.link && (
          <a class="btn btn-sm bg-white text-[#0056A8] hover:bg-white/90" href={primaryCta.link}>
            {primaryCta.label}
          </a>
        )
      }
    </div>
    </nav>
  </div>

  <div
    id="mobile-nav"
    class="md:hidden hidden border-t border-white/20 bg-[#004b94]"
  >
    <ul class="site-header__menu flex flex-col px-6 py-4 space-y-2 text-base">
      {
        menu.main.map((menuItem) => (
          <li>
            <a
              href={menuItem.url}
              class:list=[
                "site-header__menu-link site-header__menu-link--mobile",
                isMenuItemActive(menuItem.url) && "is-active",
              ]
              style="color:#ffffff"
            >
              {menuItem.name}
            </a>
          </li>
        ))
      }
    </ul>

    <div class="px-6 pb-6 flex items-center justify-between text-white">
      {settings?.theme_switcher && <ThemeSwitcher className="flex" />}
      {
        primaryCta?.label && primaryCta?.link && (
          <a class="btn btn-sm bg-white text-[#0056A8] hover:bg-white/90" href={primaryCta.link}>
            {primaryCta.label}
          </a>
        )
      }
    </div>
  </div>
</header>

<script>
  document.addEventListener("astro:page-load", () => {
    const toggle = document.querySelector<HTMLButtonElement>("#mobile-nav-toggle");
    const mobileNav = document.querySelector<HTMLDivElement>("#mobile-nav");
    if (!toggle || !mobileNav) {
      return;
    }

    const openIcon = toggle.querySelector<SVGElement>("[data-icon='open']");
    const closeIcon = toggle.querySelector<SVGElement>("[data-icon='close']");

    toggle.addEventListener("click", () => {
      const isHidden = mobileNav.classList.contains("hidden");
      mobileNav.classList.toggle("hidden");
      toggle.setAttribute("aria-expanded", String(isHidden));
      openIcon?.classList.toggle("hidden", !isHidden);
      closeIcon?.classList.toggle("hidden", isHidden);
    });
  });
</script>
